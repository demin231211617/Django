Приложение доска объявлений
Теперь мы будем использовать базу данных, чтобы построить базовое приложение доски объявлений, где пользователи могут отправлять и читать короткие сообщения. Django отлично подходит для создания управляемых данными сайтов, поскольку включает простые и вместе с тем мощные средства для выполнения запросов к базе данных из программы на языке Python. Мы рассмотрим мощный встроенный интерфейс администратора Django, который обеспечивает визуальный способ внесения изменений в наши данные. 
Django предоставляет встроенную поддержку для нескольких типов баз данных. Имея всего несколько строк в нашем файле settings.py, он может поддерживать PostgreSQL, MySQL, Oracle или SQLite. Но самым простым на сегодняшний день является SQLite, потому что он работает с одним файлом и не требует сложной установки. В отличие от других, опции которых требуют, чтобы процессы работали в фоновом режиме и могут быть довольно сложными для настройки. Django использует SQLite по умолчанию и это идеальный выбор для небольших проектов.

Начальная настройка
Создайте новый проект и проведите начальную настройку. 
Проект создаем только на диске S.
Нам необходимо выполнить следующее:
⦁	создать новый каталог для нашего кода 
⦁	установить Django в новой виртуальной среде
⦁	создать новый проект 
⦁	создать новое приложение posts
⦁	обновить settings.py
Затем выполните команду migrate, чтобы создать исходную базу данных на основе настроек Django по умолчанию.
python manage.py migrate
Если вы посмотрите в наш каталог, вы увидите, что у нас появился файл db.sqlite3 представляющий нашу базу данных SQLite.
Чтобы убедиться, что все работает правильно, запустите наш локальный сервер. На странице должно отображаться приветствие Django.

Шаблон проектирования MTV (или MVC) 
Прежде чем продолжить, поговорим немного об общем подходе к проектированию веб-приложений, работающих с данными, в Django. 
Django поощряет слабую связанность и строгое отделение различных компонентов приложения друг от друга. Следование этой идеологии позволяет без труда вносить изменения в одну часть приложения, не затрагивая остальные.
Так, говоря о функциях представлений, мы обсудили, как важно отделять бизнес-логику от логики отображения с помощью системы шаблонов. Уровень работы с базой данных – применение той же идеологии к логике доступа к данным. 
В совокупности эти три части – логика доступа к данным, бизнес-логика и логика отображения – составляют шаблон проектирования, который иногда называют Модель-Представление-Контроллер (Model-View-Controller – MVC). Здесь «модель» относится к уровню доступа к данным, «представление» – к той части системы, которая выбирает, что отображать и как отображать, а «контроллер» – к части системы, которая в зависимости от введенных пользователем данных решает, какое представление использовать, и при необходимости обращается к модели. 
Опишем примерное соответствие между буквами M, V, C и концепциями Django: 
• M – часть, касающаяся доступа к данным; соответствует уровню работы с базой данных в Django; он описывается в этой главе; 
• V – часть, касающаяся решения о том, что и как отображать, соответствует представлениям и шаблонам; 
• C – часть, которая передает управление некоторому представлению в зависимости от того, что ввел пользователь, реализована самим фреймворком с помощью конфигурации URL, которая говорит, какую функцию представления вызывать для данного URL. 
Поскольку буква «C» реализована самим фреймворком, а самое интересное происходит в моделях, шаблонах и представлениях, то поэтому Django стали называть MTV-фреймворком, где: 
• M означает «Model» (модель), то есть уровень доступа к данным. На этом уровне сосредоточена вся информация о данных: как получить к ним доступ, как осуществлять контроль, каково их поведение, каковы отношения между данными. 
• T означает «Template» (шаблон), уровень отображения. Здесь принимаются решения, относящиеся к представлению данных: как следует отображать данные на веб-странице или в ином документе. 
• V означает «View» (представление), уровень бизнес-логики. На этом уровне расположена логика доступа к модели и выбора подходящего шаблона (или шаблонов). Можно сказать, что это мост между моделями и шаблонами. 

Создание модели базы данных
Модель в Django представляет собой описание данных в базе, представленное на языке Python. Это эквивалент SQL-команды CREATE TABLE, только написанный не на SQL, а на Python, и включающий гораздо больше, чем определения столбцов.
Наша первая задача создать модель базы данных, где мы можем хранить и отображать сообщения от наших пользователей. Для нас Django превратит эту модель в таблицу базы данных. В реальных проектах Django часто бывает так, что будет много сложных взаимосвязанных моделей баз данных, но в нашем простом приложении для доски объявлений нам нужна только одна.
Откройте файл posts/models.py и посмотрите на код по умолчанию, который предоставляет Django:
Django импортирует модуль models, чтобы помочь нам построить новые модели баз данных, которые будут “моделировать” характеристики данных в нашей базе данных. Мы хотим создать модель для хранения текстового содержимого сообщений в доске объявлений, которую мы можем выполнить следующим образом:
 
Прежде всего, отметим, что любая модель представлена классом, наследующим класс django.db.models.Model. Родительский класс Model содержит все необходимое, чтобы эти объекты могли взаимодействовать с базой данных, поэтому наши модели отвечают только за определение собственных полей, так что мы получаем красивую и компактную запись.
Обратите внимание, что мы создали новую модель базы данных, которая имеет текстовое поле данных. Мы также определили тип контента, который он будет содержать, TextField(). Django предоставляет множество полей модели, поддерживающих общие типы контента, такие как символы, даты, целые числа, электронные письма и так далее.
Вообще говоря, каждая модель соответствует одной таблице базы данных, а каждый атрибут модели – одному столбцу таблицы. Имя атрибута соответствует имени столбца, а тип поля (например, TextField) – типу столбца (например, varchar). 
Также если вы заметили, мы не определили явно первичный ключ. Указывать первичный ключ в Django необязательно, так как он автоматически включает в каждую модель автоинкрементный первичный ключ целого тип с именем id.

Активация моделей
Теперь, когда наша новая модель создана, нам нужно ее активировать, но для начала проверим правильность моделей, следующей командой:
python manage.py validate
Команда validate проверяет синтаксис и логику моделей. Если все нормально, то появится сообщение 0 errors found (найдено 0 ошибок). В противном случае проверьте правильность написания кода. В сообщении об ошибке приведена информация, помогающая понять, что не так.
Всякий раз при возникновении подозрений относительно моделей выполняйте команду python manage.py validate. Она обнаруживает все типичные ошибки в моделях. Если ошибок нет можно переходить далее. 
В будущем, когда мы создаем или изменяем существующую модель необходимо обновлять Django в два этапа.
⦁		Сначала мы создаем файл миграции с помощью команды makemigrations, которая генерирует команды SQL для предустановленных приложений в нашем параметре INSTALLED_APPS. Файлы миграции не выполняют эти команды в файле базы данных, а являются ссылкой на все новые изменения в наших моделях. Этот подход означает, что у нас есть запись изменений в наших моделях.
⦁		Во-вторых, мы создаем фактическую базу данных с помощью migrate, которая выполняет инструкции в нашем файле migrations.

python manage.py makemigrations 
python manage.py migrate 

Административный интерфейс Django 
Административный интерфейс – необходимая составная часть некоторых веб-сайтов. Так называется веб-интерфейс, доступный только уполномоченным администраторам сайта и позволяющий добавлять, редактировать и удалять содержимое сайта. Вот несколько типичных примеров: интерфейс, с помощью которого вы добавляете записи в свой блог; интерфейс для модерирования сообщений, оставляемых пользователями; средства, с помощью которых заказчики добавляют новые пресс-релизы на сайт, который вы для них разработали. 
Но создавать административные интерфейсы скучно. Разработка части сайта, обращенной к публике, – удовольствие, а административные интерфейсы похожи друг на друга как две капли воды. Нужно аутентифицировать пользователей, отображать формы и обрабатывать отправленные с их помощью данные, проверять введенные данные и т. д. Утомительная, повторяющаяся работа. 
А как фреймворк Django подходит к утомительной, повторяющейся работе? Он делает ее за вас – всего в паре строчек кода. Раз вы пользуетесь Django, можете считать, что задача написания административного интерфейса уже решена. 
Для реализации этой функции система считывает метаданные из вашей модели и создает мощный готовый к эксплуатации интерфейс, с которым администраторы могут сразу же начать работу. Мы рассмотрим, как этот механизм активизировать, использовать и подстроить под свои нужды.
Пакеты django.contrib
Автоматический административный интерфейс Django – часть более широкого набора приложений, именуемого django.contrib. В него входят разнообразные полезные дополнения к ядру каркаса. Можно считать django.contrib аналогом стандартной библиотеки Python – необязательная, принятая де-факто реализация часто встречающихся задач. Эти пакеты поставляются вместе с Django, чтобы избавить вас от необходимости изобретать велосипед при разработке собственных приложений.
Основной пакет - административный интерфейс django.contrib.admin. В состав пакета django.contrib входят также система аутентификации пользователей (django.contrib.auth), поддержка анонимных сеансов (django.contrib.sessions) и даже система сбора замечаний пользователей (django.contrib.comments). По мере обретения опыта работы с Django вы познакомитесь и с другими возможностями, имеющимися в django.contrib. 
Пока достаточно знать, что Django поставляется в комплекте с полезными дополнительными модулями, которые обычно находятся в django.contrib.

Использование Django Admin
Для начала проверим, что все настроено верно:
⦁	Проверьте, что в параметре INSTALLED_APPS добавлено приложение django.contrib.admin (если оно отсутствует – добавьте его самостоятельно).
⦁	Проверьте, что INSTALLED_APPS содержит строки django.contrib.auth, django.contrib.contenttypes и django.contrib.sessions. Эти три пакета необходимы для работы административного интерфейса Django. 
⦁	Проверьте, что параметр MIDDLEWARE_CLASSES содержит строки django. middleware.common.CommonMiddleware, django.contrib.sessions.middleware. SessionMiddleware и django.contrib.auth.middleware.AuthenticationMiddleware.

Далее, чтобы использовать Django админ, нам сначала нужно создать суперпользователя, который может войти в систему. В консоли командной строки введите python manage.py createsuperuser и заполните ответы на запросы для имени пользователя, электронной почты и пароля. Поле эл.почты можно оставить пустым. Имя пользователя и пароль установите, как root, чтобы не забыть его в будущем.
Далее проверим файл urls.py. В нем должна находится строка для перехода в интерфейс администратора:
 
Теперь перезапустите сервер Django с помощью python manage.py runserver и в браузере перейдите к http://127.0.0.1:8000/admin/. Вы должны увидеть экран входа администратора:
 
Работа с административным интерфейсом
Административный интерфейс предназначен для обычных пользователей, а не для технических специалистов, поэтому практически не нуждается в пояснениях. 
На странице авторизации введите имя пользователя и пароль, указанные вами при добавлении суперпользователя. Если система не пускает, убедитесь, что создана учетная запись суперпользователя, – выполните команду python manage.py createsuperuser.
После успешного входа в систему вы увидите начальную страницу: 
Но где наше приложение posts? Оно не отображается на главной странице администратора! Поскольку вы еще не активировали ни одну из своих моделей, то список невелик, в нем есть только группы (Groups) и пользователи (Users). Эти модели включаются в административный интерфейс по умолчанию.
Нам же необходимо явно указать Django, что отображать в админке. К счастью, мы можем легко изменять это, открыв файл posts/admin.py и отредактировать его следующим образом:
 
Django теперь знает, что он должен отображать наше posts приложение и его модель базы данных Post на странице администратора. Если вы обновите свой браузер, вы увидите, что теперь оно появилось:
 
Теперь давайте создадим наш первый пост в доске объявлений для нашей базы данных. Нажмите на кнопку + Add напротив Posts. Введите свой текст в текстовое поле.
Затем нажмите кнопку "Save", которая перенаправит вас на главную страницу Post. Однако, если вы посмотрите внимательно, то есть проблема: Наша новая запись называется “Post object”, что не очень полезно.
Давайте изменим эту ситуацию. В файле posts/models.py добавьте новую функцию str как в примере:
 
К классу Post мы добавили метод str который позволяет вместо стандартного названия настроить собственное отображение названия. В данном случае, названием будут первые 50 символов текстового поля.
Теперь если вы обновите страницу администратора в браузере, вы увидите, что она изменена на гораздо более наглядное и полезное отображение нашей записи базы данных.
Рекомендуется добавлять методы str() ко всем моделям, чтобы улучшить их читаемость. Обратите внимание, что данный метод должен назваться строго как на скриншоте (два нижних подчеркивания в начале и конце str).

Как работает административный интерфейс?
Как же на самом деле работает административный интерфейс? Довольно просто. Когда во время запуска сервера фреймворк Django загружает конфигурацию URL из файла urls.py, он выполняет инструкцию admin.autodiscover(), добавленную нами во время активации административного интерфейса. Эта функция обходит все элементы в списке приложений INSTALLED_APPS и в каждом из них отыскивает файл с именем admin.py. Если файл найден, то выполняется находящийся в нем код.
В файле admin.py для нашего приложения books каждый вызов метода admin.site.register() просто регистрирует одну из моделей в административном интерфейсе. А в списке моделей, доступных для редактирования, отображаются только явно зарегистрированные.
Приложение django.contrib.auth тоже включает файл admin.py, потому-то и присутствуют в таблице строки Users и Groups. Регистрируются в административном интерфейсе и другие приложения из пакета django. contrib, такие как django.contrib.redirects, а также многие сторонние приложения Django, которые есть в Интернете. 
Во всех остальных отношениях административный интерфейс – обычное приложение Django со своими моделями, шаблонами, представлениями и образцами URL. Чтобы добавить его в свой проект, нужно завести образцы URL точно так же, как вы делаете это для собственных представлений. Заглянув в каталог django/contrib/admin в своей копии дистрибутива Django, вы сможете изучить шаблоны, представления и образцы URL административного интерфейса, но не пытайтесь что-то изменять прямо там, потому что есть вполне достаточно официальных точек подключения, позволяющих настроить работу административного интерфейса под себя. (Если вы все-таки решитесь модифицировать это приложение, имейте в виду, что при чтении метаданных о моделях оно делает довольно хитрые вещи, поэтому на то, чтобы разобраться в коде, может уйти много времени.)

Views/Templates/URLs
Для того, чтобы отобразить содержимое нашей базы данных на нашей домашней странице, мы должны подключить наши views, templates и urls. 
Начнем с view. Ранее мы использовали встроенный универсальный Template- View для отображения файла шаблона на нашей домашней странице. Теперь мы хотим перечислить содержимое нашей модели базы данных. К счастью, это общая задача в веб-разработке и Django поставляется с универсальным основным-классом ListView.
В posts/views.py файле введите код Python ниже:
 
В первой строке мы импортируем ListView, а во второй строке нам нужно явно определить, какую модель мы используем. В view мы создаем подкласс ListView, указываем название модели и указываем ссылку на шаблон. Внутри ListView возвращает объект с именем object_list, который мы хотим отобразить в нашем шаблоне (template).
Наш view готов, что означает, что нам все еще нужно настроить наши URL-адреса и сделать наш шаблон(template). Начнем с шаблона. Создадим каталог на уровне проекта с именем templates и файл шаблона home.html.
Затем обновите поле DIRS в settings.py файле.
В нашем файле шаблона home.html мы можем использовать Язык шаблонов Django для цикла, чтобы перечислить все объекты в object_list. Помните, что object_list - это то, что ListView возвращает нам.
 
Последний шаг заключается в том, чтобы настроить наш urls.py. 
 
Так как в views мы создали не функцию, а класс, то для использования его как представления необходимо вызвать метод as_view().
Перезапустите сервер с python manage.py runserver и перейдите на наш сайт http://127.0.0.1:8000/ в котором теперь перечислены наши сообщения на доске объявлений.
Создайте в Django Admin еще несколько записей и убедитесь, что все они выводятся на страницу.
Загрузите проект на GitHub.
